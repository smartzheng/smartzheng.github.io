<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Hugo 0.55.6" />


<title>利用SpannableString富文本方式设置圆角标签背景 - smartzheng</title>
<meta property="og:title" content="利用SpannableString富文本方式设置圆角标签背景 - smartzheng">



  






<link rel="stylesheet" href="https://smartzheng.github.io/css/main.css" media="all">
<link rel="stylesheet" href="https://smartzheng.github.io/css/fonts.css">

  </head>
  <body>
    <div class="wrapper">
      <header class="header">
        <nav class="nav">
  <a href="https://smartzheng.github.io/" class="nav-logo">
    <img src="https://smartzheng.github.io/images/logo.png" 
         width="50" 
         height="50" 
         alt="Logo">
  </a>

  <ul class="nav-links">
    
    <li><a href="/categories">Categories</a></li>
    
    <li><a href="https://github.com/smartzheng">About</a></li>
    
  </ul>
</nav>

      </header>


<main class="content" role="main">
  <article class="article">
    <h1 class="article-title">利用SpannableString富文本方式设置圆角标签背景</h1>
    

    <div class="article-content">
      <p>####项目中遇到一个需求,需要在商品标题加上标签,而标签是客户可以后台配置的,所以不是用的图片,而是用的文字.如下图:
<img src="https://upload-images.jianshu.io/upload_images/2983970-c45ecdf7ffd29eb2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/340" alt="" /></p>

<p>####众所周知,在Android中,View都是呈方形布置的,所以如果标签和文字如果不是同一个View,那么如果文字换行,就会出现标签和TextView分别在左右两边的效果:
<img src="https://upload-images.jianshu.io/upload_images/2983970-276b1e708bb147d1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/340" alt="" /></p>

<p>####经过思考和查阅资料,发现可以用SpannableString设置背景,并通过重写ReplacementSpan替换原来的BackgroundColorSpan来实现圆角标签.
####下面是代码:</p>

<p>Activity: (goodsTags为标签文字集合,即上图的&rdquo;促&rdquo;,&ldquo;九&rdquo;,&ldquo;八&rdquo;&hellip;goodsName为商品名字</p>

<pre><code>for (int i = 0; i &lt; goodsTags.size(); i++) {
	//为了显示效果在每个标签文字前加两个空格,后面加三个空格(前两个和后两个填充背景,最后一个作标签分割)
    goodsName.insert(0, &quot;  &quot; + goodsTags.get(i).getTags_name() + &quot;   &quot;);
    int start = 0;
    int end = 5;
    //稍微设置标签文字小一点
    goodsName.setSpan(new RelativeSizeSpan(0.9f), start, end, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);
    //设置圆角背景
    goodsName.setSpan(new RoundBackgroundColorSpan(Color.parseColor(&quot;#&quot; + goodsTags.get(i).getTags_color()),Color.WHITE), start, end, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);
}
</code></pre>

<p>自定义RoundBackgroundColorSpan:</p>

<pre><code>public class RoundBackgroundColorSpan extends ReplacementSpan {
    private int bgColor;
    private int textColor;
    public RoundBackgroundColorSpan(int bgColor, int textColor) {
        super();
        this.bgColor = bgColor;
        this.textColor = textColor;
    }
    @Override
    public int getSize(Paint paint, CharSequence text, int start, int end, Paint.FontMetricsInt fm) {
   		//设置宽度为文字宽度加16dp
        return ((int)paint.measureText(text, start, end)+Util.px2Dp(16));
    }

    @Override
    public void draw(Canvas canvas, CharSequence text, int start, int end, float x, int top, int y, int bottom, Paint paint) {
        int originalColor = paint.getColor();
        paint.setColor(this.bgColor);
        //画圆角矩形背景
        canvas.drawRoundRect(new RectF(x,
                top+ Util.px2Dp(3),
                x + ((int) paint.measureText(text, start, end)+ Util.px2Dp(16)),
                bottom-Util.px2Dp(1)),

                Util.px2Dp(4),
                Util.px2Dp(4),
                paint);
        paint.setColor(this.textColor);
        //画文字,两边各增加8dp
        canvas.drawText(text, start, end, x+Util.px2Dp(8), y, paint);
        //将paint复原
        paint.setColor(originalColor);
    }
}
</code></pre>

    </div>
 
    <ul class="article-taxonomy">
                  
      <hr>
      <li>
        <i class="fa fa-category"></i><a href="/categories/android">Android</a>
      </li>
      
    
      
  </article>

</main>

      <footer class="footer">
        <ul class="footer-links">
          <li>
            <a href="https://smartzheng.github.io/index.xml" type="application/rss+xml" target="_blank"><i class="fa fa-rss"></i> RSS feed</a>
          </li>
          <li>
            <a href="https://github.com/mobybit/hugo-natrium-theme"><i class="fa fa-github"></i> Code</a>
          </li>
          <li>
            <a href="https://smartzheng.github.io/site-notice">Site notice</a>
          </li>
        </ul>
      </footer>

    </div>

  </body>
</html>

